这里是新版的Filer工作流程约定。

新版Filer依旧面向局域网，不提供内网之间的穿透服务。通信部分的设计将支持多点的点对点通信，也就是说从理论上来说，将支持同一局域网内的大量设备之间组成一个点对点通信网络。但是，现在的客户端UI设计可能还无法提供这样的功能。

### 版本

包含客户端软件和IP服务器。客户端软件计划提供python命令行版本，Qt windows客户端，Qt Mac客户端，iOS App可能会在后续尝试完成，但预计不会上架App store。



### 通信协议

现在的设计是要求，所有的客户端统一使用我在socket-module里面设计的应用层通信协议。在此基础上实现具体的Filer协议细节。



首先，每个客户端都必须同时开启一个TCP客户端，一个TCP服务端，一个IP报告的客户端。

客户端在工作中需要定时向服务器汇报信息，作为心跳包，信息结构为：

~~~python
{"ID":my_id, "Port": my_server_port}
~~~

这些信息需要被放入headers中发送。

IP服务器会定时向每个保持心跳的客户端发送当前所有在线设备的信息，包括接收到信息的客户端的信息(这意味着用户需要自行剔除自身信息)

信息结构为：

~~~
{"Broadcast":""}
ID,IP,Port;ID,IP,Port
~~~

即有包含了一个键为Broadcast的头部，设备信息被放入body部分，结构如上。



设备之间的通信协议暂时不确定。基本就是message可以放入header，然后文件的话内容放入body，但是具体切分方法尚不确定。